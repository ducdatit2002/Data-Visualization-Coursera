<html>
  <head>
    <style>
      body {
        font-family: Helvetica, Arial, sans-serif;
      }
      h1 {
        background-color: #2a5599;
        color: white;
        padding: 5px;
      }
      svg {
        border: 1px solid black;
      }
      .mainView {
        display: flex;
      }
    </style>
    <script src="d3.js"></script>
  </head>

  <body>
    <h1>Airlines Routes</h1>
    <div class="mainView">
      <div>
        <h2>Airlines</h2>
        <svg id="AirlinesChart"></svg>
      </div>
      <div>
        <h2>Airports</h2>
        <svg id="Map"></svg>
      </div>
    </div>
  </body>
  <script>
    let store = {};

    function loadData() {
      let promise = d3.csv("routes.csv");
      return promise.then((routes) => {
        store.routes = routes;
        return store;
      });
    }
    function groupByAirline(data) {
      let result = data.reduce((result, d) => {
        let currentData = result[d.AirlineID] || {
          AirlineID: d.AirlineID,
          AirlineName: d.AirlineName,
          Count: 0,
        };
        currentData.Count++;
        result[d.AirlineID] = currentData;
        return result;
      }, {});

      //We use this to convert the dictionary produced by the code above, into a list, that will make it easier to create the visualization.
      result = Object.keys(result).map((key) => result[key]);
      result = Object.values(result);
      result.sort((a, b) => b.Count - a.Count);

      return result;
    }
    function getAirlinesChartConfig() {
      let width = 350;
      let height = 400;
      let margin = {
        top: 10,
        bottom: 50,
        left: 130,
        right: 10,
      };
      //The body is the are that will be occupied by the bars.
      let bodyHeight = height - margin.top - margin.bottom;
      let bodyWidth = width - margin.left - margin.right; //TODO: Compute the width of the body by subtracting the left and right margins from the width.

      //The container is the SVG where we will draw the chart. In our HTML is the svg ta with the id AirlinesChart
      let container = d3.select("#AirlinesChart");
      container.attr("width", width).attr("height", height);

      return { width, height, margin, bodyHeight, bodyWidth, container };
    }
    function showData() {
      //Get the routes from our store variable
      let routes = store.routes;
      // Compute the number of routes per airline.
      let airlines = groupByAirline(store.routes);
      console.log(airlines);
      // Draw airlines barchart
      drawAirlinesChart(airlines);
    }
    function getAirlinesChartScales(airlines, config) {
    let { bodyWidth, bodyHeight } = config;
    let maximunCount = //TODO: Use d3.max to get the highest Count value we have on the airlines list.

    let xScale = d3.scaleLinear()
        //TODO: Set the range to go from 0 to the width of the body
        //TODO: Set the domain to go from 0 to the maximun value fount for the field 'Count'

    let yScale = d3.scaleBand()
        .range([0, bodyHeight])
        .domain(airlines.map(a => a.AirlineName)) //The domain is the list of ailines names
        .padding(0.2)
        
    return { xScale, yScale }
}
    loadData().then(showData);
  </script>
</html>
